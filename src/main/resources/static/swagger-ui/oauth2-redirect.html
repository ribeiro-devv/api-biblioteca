<!DOCTYPE html>
<html lang="en">
<head>
    <title>OAuth2 Redirect</title>
</head>
<body>
<script>
    (function () {
      function parseParams() {
        var params = {};
        var queryString = location.search.substring(1);
        var regex = /([^&=]+)=([^&]*)/g, m;
        while (m = regex.exec(queryString)) {
          params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
        }
        return params;
      }

      function sendAuthCode() {
        var params = parseParams();
        var state = params["state"];
        var code = params["code"];
        var error = params["error"];

        // Reenvia para Swagger UI
        if (window.opener && window.opener.swaggerUIRedirectOauth2) {
          window.opener.swaggerUIRedirectOauth2({
            code: code,
            state: state,
            error: error
          });
          window.close();
        } else {
          document.body.innerText = "Erro: não foi possível comunicar com Swagger UI.";
        }
      }

      sendAuthCode();
    })();
</script>
</body>
</html>